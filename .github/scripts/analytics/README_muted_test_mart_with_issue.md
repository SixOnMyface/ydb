# Enhanced Muted Test Data Mart with GitHub Issue Links

This documentation describes the enhanced muted test data mart that includes GitHub issue links for muted tests.

## Overview

The enhanced data mart `test_results/analytics/test_muted_monitor_mart_with_issue` extends the standard muted test monitor data mart by adding GitHub issue information for each muted test.

## How it Works

1. **Data Sources**: 
   - `test_results/analytics/tests_monitor` - Source of muted test data
   - `github_data/issues` - Source of GitHub issue data

2. **Issue Matching Logic**:
   - Parses GitHub issue bodies to extract test names using the same logic as `update_mute_issues.py`
   - Looks for test names between `<!--mute_list_start-->` and `<!--mute_list_end-->` markers
   - Falls back to parsing simple "Mute:" prefixed lists
   - Matches tests with issues based on test name and optionally branch

3. **Enhanced Columns**:
   - `github_issue_url` - Direct link to the GitHub issue
   - `github_issue_title` - Title of the GitHub issue
   - `github_issue_number` - Issue number for easy reference

## Execution

The enhanced data mart is generated by the script `.github/scripts/analytics/test_muted_monitor_mart_with_issue.py` which runs as part of the `collect_analytics_fast.yml` workflow.

## Error Handling

- Gracefully handles missing source tables
- Continues processing even if GitHub issues data is unavailable
- Tests without associated issues have NULL values in the GitHub issue columns
- Robust type handling for various YDB column types

## Example Usage

```sql
-- Find muted tests with their associated GitHub issues
SELECT 
    full_name,
    branch,
    state,
    days_in_state,
    github_issue_url,
    github_issue_title
FROM `test_results/analytics/test_muted_monitor_mart_with_issue`
WHERE github_issue_url IS NOT NULL
ORDER BY days_in_state DESC
```

```sql
-- Find muted tests that don't have associated GitHub issues
SELECT 
    full_name,
    branch,
    state,
    days_in_state,
    resolution
FROM `test_results/analytics/test_muted_monitor_mart_with_issue`
WHERE github_issue_url IS NULL
AND resolution = 'MUTED: delete candidate'
ORDER BY days_in_state DESC
```

## Maintenance

The table is automatically refreshed every 30 minutes as part of the analytics workflow. It includes a TTL of 43200 minutes (30 days) to automatically clean up old data.