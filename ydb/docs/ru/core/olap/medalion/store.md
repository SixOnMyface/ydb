# Хранение данных

![](_includes/olap_storage.png)

Возможность эффективно хранить данные и эффективно их обрабатывать - одна из основных возможностей КХД. В данном разделе описываются основные возможности {{ydb-short-name}} в области хранения и обработки данных.

## Колоночные таблицы {#column_table}

[Колоночные таблицы {{ydb-short-name}}](../../concepts/datamodel/table.md#column-oriented-tables) хранят данные каждого столбца отдельно (независимо) от других столбцов. Такой принцип хранения данных оптимизирован для работы с Online Analytical Processing-нагрузками (OLAP), так как при выполнении запроса считываются только те столбцы, которые непосредственно участвуют в запросе. Еще один плюс такого подхода — высокая степень сжатия данных, так как в столбцах зачастую хранятся повторяющиеся или близкие данные.

В {{ydb-short-name}} слой хранения и обработки данных [отделены друг от друга](../../concepts/cluster_structure.md), это позволяет независимо масштабировать базу данных без периодов простоя и без необходимости миграции данных.

Данные для хранения распределяются по компонентам хранения данных - шардам. Выбор шарда для для каждой конкретной записи с помощью ключа [партиционирования](../../concepts/datamodel/table.md#olap-tables-partitioning), а сами шарды распределяются по всем доступным узлам базы данных. Нагрузка на систему постоянно отслеживается [специальным компонентом - Hive](../../contributor/hive.md), который остлеживает число доступных узлов, нагрузку на них и принимает решение о необходимости ребалансировки шардов. Так как в {{ydb-short-name}} слой хранения отделен от слоя исполнения, то процесс ребалансировки состоит только в переносе метаданных с одного узла на другой и выполняется практически мгновенно.

## Хранение данных

На каждом узле хранения данные хранятся в структурах хранения, упорядоченными по первичному ключу. В связи с этим важно [выбирать корректные первичные ключи таблиц](../dev/primary-key/column-oriented).

Данные хранятся в поколоночном формате с алгоритмом сжатия `LZ4`. Этот алгоритм обеспечивает оптимальный баланс между качеством сжатия и скоростью работы с данными.

Для хранения данных используются специализированные структуры хранения - [LSM-деревья](../../concepts/mvcc#organizaciya-hraneniya-dannyh-mvcc). Особенностью этой структуры является постоянный фоновый процесс оптимизации хранимых данных, из-за чего нет необходимости в специальных командах типа `VACUUM` для оптимизации формата хранения. Кроме этого, на этапе оптимизации выполняется и физическое выравнивание данных по первичному ключу, что ускоряет поиск данных.

## Надежность

![](_includes/olap_3dc.png){width=500}

{{ydb-short-name}} изначально создавалась, как отказоустойчивая база данных, поэтому в базе данных поддерживаются [несколько режимов обеспечения отказоустойчивости](../../concepts/topology#cluster-config):

- `block 4-2` для работы внутри одного датацентра, обеспечивает бесперебойную работу при отключении стойки оборудования
- `mirror 3dc` для работы в нескольких датацентрах, обеспечивает бесперебойную работу при потере одного датацентра целиком

## Удаление данных

Данные можно удалять явно, с использованием стандартных команд [`DELETE`](../../yql/reference/syntax/delete.md) или с помощью автоматического механизма [удаления по TTL](../../concepts/ttl.md).
