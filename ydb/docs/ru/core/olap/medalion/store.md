# Хранение данных

![](_includes/olap_store.png)

Возможность эффективно хранить данные и эффективно их обрабатывать - одна из основных возможностей КХД. В данном разделе описываются основные возможности {{ydb-short-name}} в области хранения и обработки данных.

- [{#T}](column_table)

## Колоночные таблицы {#column_table}

[Колоночные таблицы {{ydb-short-name}}](../../concepts/datamodel/table.md#column-oriented-tables) хранят данные каждого столбца отдельно (независимо) от других столбцов. Такой принцип хранения данных оптимизирован для работы с Online Analytical Processing-нагрузками (OLAP), так как при выполнении запроса считываются только те столбцы, которые непосредственно участвуют в запросе. Еще один плюс такого подхода — высокая степень сжатия данных, так как в столбцах зачастую хранятся повторяющиеся или близкие данные.

В {{ydb-short-name}} слой хранения и обработки данных [отделены друг от друга](../../concepts/cluster_structure.md), это позволяет независимо масштабировать базу данных без периодов простоя и без необходимости миграции данных.


- [Выбор ключей для колоночных таблиц](../dev/primary-key/column-oriented).
- [Партиционирование](../concepts/datamodel/table.md#olap-tables-partitioning) данных.

- [!!!ссылка на описание оптимизатора](../yql/reference/index.md).

Распределённые JOIN-ы. Планирование обменов данными между узлами, стратегии перераспределения.
Где читать: Концепции → Распределённые операторы; Руководство → Соединения в MPP.


Колоночные таблицы

Организация хранения

Производительность и масштабирование

Согласованность и параллелизм

Типы и схемы

Жизненный цикл данных

Оптимизация запросов

Spilling

Наблюдаемость

Ограничения текущей версии

См. также

Колоночные таблицы

Колоночные таблицы доступны по умолчанию и предназначены для аналитических сценариев: независимое хранение столбцов, эффективная компрессия, параллельные сканы и агрегации. Поддерживаются DDL/DML-операции (INSERT/UPSERT/UPDATE/DELETE, CREATE TABLE AS SELECT, RENAME TABLE) и типы DateTime64, Parametrized Decimal для широких диапазонов и высокой точности.

Организация хранения

Раздельное хранение столбцов с LZ4-сжатием. Снижает объём и ускоряет чтение по нужным полям.

Партиционирование по хешу первичного ключа. Равномерное распределение нагрузки при вставке и чтении.

Физическая укладка под сканы. Колоночный layout, компактные сегменты, предсказуемые последовательные чтения.

Производительность и масштабирование

MPP-чтение по всем узлам. Распараллеливание тяжёлых запросов по кластеру.

BulkUpsert для загрузки. Высокоскоростной batch-ingest больших объёмов (без транзакционных гарантий).

Независимое масштабирование storage/compute. Эластичность под пиковые окна и рост данных.

Согласованность и параллелизм

Уровень изоляции: Serializable (для колоночных таблиц). Максимальная согласованность при конкурентных операциях.

Типы и схемы

Поддержка эволюции схемы (DDL), переименования таблиц, генерации витрин через CTAS.

Типы для аналитики: DateTime64, параметризуемые десятичные (Decimal(p,s)).

Жизненный цикл данных

TTL-политики. Автоматическое удаление устаревших записей по заданным правилам хранения.

Оптимизация запросов

Стоимостной оптимизатор (CBO). Выбор плана по оценке стоимости, автоматическое обновление базовой статистики.

Hints. Возможность повлиять на выбор плана в сложных случаях.

Spilling

Вытеснение промежуточных данных на диск. Сортировки, соединения и агрегации продолжают работать при объёмах, превышающих RAM узла.

Наблюдаемость

Метрики, профили выполнения, диагностика планов и использование памяти для колоночных операций.

Управление нагрузкой: контроль числа параллельных запросов, лимиты памяти на колоночные операторы.

Ограничения текущей версии

Нельзя смешивать колоночные и строковые таблицы в модифицирующих запросах.

Единственный изоляционный уровень для колоночных таблиц — Serializable.

Нет вторичных/векторных индексов и фильтров Блума.

Автоматическое «охлаждение» колоночных данных во внешние хранилища недоступно.

Backup/Restore для колоночных таблиц недоступны.

CDC для колоночных таблиц не реализован.

См. также

Ввод данных: топики (Kafka-совм.), Transfer, BulkUpsert, JDBC-драйверы — инструменты поставки данных в таблицы.
ydb-platform--ydb.viewer.diplodoc.com

Этот раздел фокусируется на том, что база «умеет» как колоночное хранилище: компактно хранить и быстро сканировать данные, масштабироваться горизонтально, поддерживать согласованность и эффективно выполнять тяжёлые аналитические планы, в том числе с вытеснением на диск.
